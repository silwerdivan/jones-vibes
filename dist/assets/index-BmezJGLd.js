(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class ${id;cash;savings;happiness;educationLevel;careerLevel;time;location;hasCar;loan;inventory;hunger;timeDeficit;weeklyIncome;weeklyExpenses;weeklyHappinessChange;isAI=!1;name="";constructor(e){this.id=e,this.cash=0,this.savings=0,this.happiness=50,this.educationLevel=0,this.careerLevel=0,this.time=24,this.location="Home",this.hasCar=!1,this.loan=0,this.inventory=[],this.hunger=0,this.timeDeficit=0,this.weeklyIncome=0,this.weeklyExpenses=0,this.weeklyHappinessChange=0}addCash(e){this.cash+=e,this.weeklyIncome+=e}spendCash(e){return this.cash>=e?(this.cash-=e,this.weeklyExpenses+=e,!0):!1}updateHappiness(e){const t=this.happiness;this.happiness+=e,this.happiness>100?this.happiness=100:this.happiness<0&&(this.happiness=0),this.weeklyHappinessChange+=this.happiness-t}resetWeeklyStats(){this.weeklyIncome=0,this.weeklyExpenses=0,this.weeklyHappinessChange=0}advanceEducation(){this.educationLevel++}advanceCareer(){this.careerLevel++}deductTime(e){this.time-=e}setTime(e){this.time=e}setLocation(e){this.location=e}giveCar(){this.hasCar=!0}takeLoan(e){this.loan+=e}repayLoan(e){return this.loan>=e?(this.loan-=e,!0):!1}deposit(e){return this.cash>=e?(this.cash-=e,this.savings+=e,!0):!1}withdraw(e){return this.savings>=e?(this.savings-=e,this.cash+=e,!0):!1}}const f=[{level:1,title:"Dishwasher",wage:8,shiftHours:6,educationRequired:0},{level:2,title:"Fast Food Worker",wage:10,shiftHours:7,educationRequired:1},{level:3,title:"Retail Associate",wage:12,shiftHours:8,educationRequired:2},{level:4,title:"Office Clerk",wage:15,shiftHours:8,educationRequired:3},{level:5,title:"Junior Accountant",wage:20,shiftHours:8,educationRequired:4}],v=[{id:1,name:"Intro to Business",cost:500,time:10,educationMilestone:1},{id:2,name:"Marketing Fundamentals",cost:750,time:15,educationMilestone:2},{id:3,name:"Financial Accounting",cost:1e3,time:20,educationMilestone:3},{id:4,name:"Business Law",cost:1250,time:25,educationMilestone:4},{id:5,name:"Advanced Management",cost:1500,time:30,educationMilestone:5}],y=[{name:"Coffee",cost:5,happinessBoost:5,type:"essential",location:"Shopping Mall"},{name:"Movie Ticket",cost:15,happinessBoost:10,type:"essential",location:"Shopping Mall"},{name:"New Clothes",cost:50,happinessBoost:20,type:"essential",icon:"clothes",benefit:"Social Standing +5%",location:"Shopping Mall"},{name:"Concert Ticket",cost:100,happinessBoost:30,type:"essential",location:"Shopping Mall"},{name:"Fridge",cost:400,happinessBoost:10,type:"asset",icon:"fridge",benefit:"Food Waste -50%",location:"Shopping Mall"},{name:"Television",cost:600,happinessBoost:40,type:"asset",icon:"television",benefit:"Relaxation +10%",location:"Shopping Mall"},{name:"Computer",cost:1200,happinessBoost:25,type:"asset",icon:"computer",benefit:"Study Speed +15%",location:"Shopping Mall"},{name:"Vacation Package",cost:500,happinessBoost:50,type:"essential",location:"Shopping Mall"},{name:"Monolith Burger",cost:10,happinessBoost:5,type:"essential",hungerReduction:40,location:"Fast Food"},{name:"Synth-Salad",cost:12,happinessBoost:8,type:"essential",hungerReduction:30,location:"Fast Food"}],c={REST_END_TURN:"UI_INTENT_REST_END_TURN",ADVANCE_TURN:"UI_INTENT_ADVANCE_TURN",WORK_SHIFT:"UI_INTENT_WORK_SHIFT",BUY_CAR:"UI_INTENT_BUY_CAR",TRAVEL:"UI_INTENT_TRAVEL",BANK_DEPOSIT:"UI_INTENT_BANK_DEPOSIT",BANK_WITHDRAW:"UI_INTENT_BANK_WITHDRAW",BANK_LOAN:"UI_INTENT_BANK_LOAN",BANK_REPAY:"UI_INTENT_BANK_REPAY",APPLY_JOB:"UI_INTENT_APPLY_JOB",TAKE_COURSE:"UI_INTENT_TAKE_COURSE",BUY_ITEM:"UI_INTENT_BUY_ITEM",REQUEST_STATE_REFRESH:"UI_REQUEST_STATE_REFRESH"},r={events:{},subscribe(a,e){this.events[a]||(this.events[a]=[]),this.events[a].push(e)},publish(a,e){this.events[a]&&this.events[a].forEach(t=>{t(e)})}};class x{takeTurn(e,t){const i=f.find(n=>n.level===t.careerLevel),s=i?i.shiftHours:8;if(t.loan>2e3&&t.time>=2){if(t.location!=="Bank")return{action:"travel",params:{destination:"Bank"}};{const n=Math.min(t.loan,t.cash);if(n>0)return{action:"repayLoan",params:{amount:n}}}}if(t.cash<1e3&&t.time>=s){if(t.location!=="Employment Agency")return{action:"travel",params:{destination:"Employment Agency"}};if(t.careerLevel===0){const n=f.filter(o=>t.educationLevel>=o.educationRequired);if(n.length>0)return{action:"applyForJob",params:{jobLevel:n.reduce((l,h)=>l.level>h.level?l:h).level}}}return{action:"workShift"}}if(t.educationLevel<v.length){const n=t.educationLevel+1,o=v.find(l=>l.educationMilestone===n);if(o&&t.cash>=o.cost&&t.time>=o.time)return t.location!=="Community College"?{action:"travel",params:{destination:"Community College"}}:{action:"takeCourse",params:{courseId:o.id}}}if(t.happiness<50&&t.time>=2){if(t.location!=="Shopping Mall")return{action:"travel",params:{destination:"Shopping Mall"}};{const n=y.filter(o=>t.cash>=o.cost);if(n.length>0)return{action:"buyItem",params:{itemName:n.reduce((l,h)=>l.cost>h.cost?l:h).name}}}}return t.cash>3500&&!t.hasCar&&t.time>=4?t.location!=="Used Car Lot"?{action:"travel",params:{destination:"Used Car Lot"}}:{action:"buyCar"}:t.location==="Employment Agency"&&t.time>=s&&t.careerLevel>0?{action:"workShift"}:{action:"pass"}}}class T{players;currentPlayerIndex;turn;DAILY_EXPENSE;gameOver;winner;aiController;log;constructor(e,t=!1){if(e<1||e>2)throw new Error("Game can only be played with 1 or 2 players.");this.players=[];for(let i=0;i<e;i++){const s=new $(i+1);i===1&&t?(s.isAI=!0,s.name="AI Opponent"):(s.isAI=!1,s.name=`Player ${i+1}`),this.players.push(s)}this.currentPlayerIndex=0,this.turn=1,this.DAILY_EXPENSE=50,this.gameOver=!1,this.winner=null,this.aiController=t?new x:null,this.log=[]}_formatMoney(e){return`$${e.toLocaleString()}`}_getPlayerName(e){return e.name||`Player ${e.id}`}publishCurrentState(){r.publish("stateChanged",this)}addLogMessage(e,t="info"){const i={text:e,category:t,timestamp:new Date().toLocaleTimeString()};this.log.unshift(i),r.publish("gameEvent",i),r.publish("stateChanged",this)}getCurrentPlayer(){return this.players[this.currentPlayerIndex]}endTurn(){const e=this.getCurrentPlayer(),t={player:e.id,playerName:this._getPlayerName(e),week:this.turn,events:[],totals:{cashChange:0,happinessChange:0}};if(e.weeklyIncome>0&&t.events.push({type:"income",label:"Weekly Earnings",value:e.weeklyIncome,unit:"$",icon:"payments"}),e.weeklyExpenses>0&&t.events.push({type:"expense",label:"Shopping & Travel",value:-e.weeklyExpenses,unit:"$",icon:"shopping_cart"}),e.spendCash(this.DAILY_EXPENSE),t.events.push({type:"expense",label:"Weekend Expenses",value:-this.DAILY_EXPENSE,unit:"$",icon:"home"}),this.addLogMessage(`${this._getPlayerName(e)} paid ${this._formatMoney(this.DAILY_EXPENSE)} for weekend expenses.`,"expense"),e.loan>0){const s=Math.round(e.loan*.1);e.loan+=s,e.weeklyExpenses+=s,t.events.push({type:"warning",label:"Loan Interest",value:-s,unit:"$",icon:"account_balance"}),this.addLogMessage(`${this._getPlayerName(e)} was charged ${this._formatMoney(s)} in loan interest.`,"warning")}e.hunger=Math.min(100,(e.hunger||0)+20),e.hunger>50&&(e.updateHappiness(-5),t.events.push({type:"warning",label:"Hunger Penalty",value:-5,unit:"Happiness",icon:"restaurant"}),this.addLogMessage(`${this._getPlayerName(e)} is feeling hungry...`,"warning")),t.totals.cashChange=e.weeklyIncome-e.weeklyExpenses,t.totals.happinessChange=e.weeklyHappinessChange,e.resetWeeklyStats();const i=e.timeDeficit;return e.setTime(24-i),i>0&&(this.addLogMessage(`${this._getPlayerName(e)} started with ${i} hour${i>1?"s":""} less due to incomplete travel.`,"warning"),e.timeDeficit=0),e.setLocation("Home"),this.addLogMessage(`${this._getPlayerName(e)} returned home.`,"info"),e.isAI&&r.publish("aiThinkingEnd"),r.publish("turnEnded",t),r.publish("stateChanged",this),t}advanceTurn(){this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.players.length,this.currentPlayerIndex===0&&this.turn++;const e=this.getCurrentPlayer();r.publish("stateChanged",this),e.isAI&&this.aiController&&(r.publish("aiThinkingStart"),setTimeout(()=>{this.processAITurn()},1e3))}processAITurn(){const e=this.getCurrentPlayer();if(this.addLogMessage(`ðŸ¤” ${this._getPlayerName(e)} is contemplating their next move...`,"info"),this.aiController){const t=this.aiController.takeTurn(this,e);this.handleAIAction(t)}}handleAIAction(e){if(!e||!e.action){r.publish("aiThinkingEnd"),this.endTurn();return}if(e.action==="pass"){this.addLogMessage(`${this._getPlayerName(this.getCurrentPlayer())} passes their turn.`,"info"),r.publish("aiThinkingEnd"),this.endTurn();return}let t=!1,i=`AI decides to: ${e.action}`;switch(e.params&&(i+=` with params: ${JSON.stringify(e.params)}`),this.addLogMessage(i,"info"),e.action){case"travel":t=this.travel(e.params.destination);break;case"workShift":t=this.workShift();break;case"applyForJob":t=this.applyForJob(e.params.jobLevel);break;case"takeCourse":t=this.takeCourse(e.params.courseId);break;case"buyItem":t=this.buyItem(e.params.itemName);break;case"buyCar":t=this.buyCar();break;case"deposit":t=this.deposit(e.params.amount);break;case"withdraw":t=this.withdraw(e.params.amount);break;case"takeLoan":t=this.takeLoan(e.params.amount);break;case"repayLoan":t=this.repayLoan(e.params.amount);break;default:console.warn(`AI tried an unknown action: ${e.action}`),t=!1;break}const s=this.getCurrentPlayer().time>0;t&&s?(this.checkWinCondition(this.getCurrentPlayer()),this.addLogMessage(`${this._getPlayerName(this.getCurrentPlayer())} is deciding next move...`,"info"),setTimeout(()=>this.processAITurn(),1e3)):(t||this.addLogMessage(`${this._getPlayerName(this.getCurrentPlayer())}'s action failed.`,"warning"),r.publish("aiThinkingEnd"),this.endTurn())}checkWinCondition(e){if(this.gameOver)return;const i=e.cash+e.savings>=1e4,s=e.happiness>=80,n=e.educationLevel>=3,o=e.careerLevel>=4;i&&s&&n&&o&&(this.gameOver=!0,this.winner=e,this.addLogMessage(`ðŸŽ‰ ${this._getPlayerName(e)} has won the game!`,"success"),r.publish("gameOver",this))}_checkAutoEndTurn(){const e=this.getCurrentPlayer();e.time<=0&&!e.isAI&&!this.gameOver&&setTimeout(()=>{e.time<=0&&(this.addLogMessage("Time is up! Turn ending automatically.","warning"),this.endTurn())},1e3)}getNextAvailableCourse(){const e=this.getCurrentPlayer();return v.find(t=>t.educationMilestone===e.educationLevel+1)||null}_getAvailableJobs(e){return f.filter(t=>e.educationLevel>=t.educationRequired)}workShift(){const e=this.getCurrentPlayer();if(e.location!=="Employment Agency")return this.addLogMessage(`${this._getPlayerName(e)} must be at the Employment Agency to work.`,"error"),!1;if(e.careerLevel===0)return this.addLogMessage(`${this._getPlayerName(e)} must apply for a job first.`,"error"),!1;const t=this._getAvailableJobs(e);if(t.length===0)return this.addLogMessage(`No jobs available for ${this._getPlayerName(e)}'s education level.`,"warning"),!1;const i=t.reduce((n,o)=>n.level>o.level?n:o);if(e.time<i.shiftHours)return this.addLogMessage(`${this._getPlayerName(e)} doesn't have enough time to work as ${i.title}.`,"error"),!1;e.deductTime(i.shiftHours);const s=i.wage*i.shiftHours;return e.addCash(s),i.level>e.careerLevel&&(e.careerLevel=i.level),this.addLogMessage(`${this._getPlayerName(e)} worked as ${i.title} and earned ${this._formatMoney(s)}.`,"success"),this.checkWinCondition(e),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0}takeCourse(e){const t=this.getCurrentPlayer(),i=v.find(s=>s.id===e);return t.location!=="Community College"?(this.addLogMessage(`${this._getPlayerName(t)} must be at the Community College to take a course.`,"error"),!1):i?t.cash<i.cost?(this.addLogMessage(`${this._getPlayerName(t)} needs ${this._formatMoney(i.cost)} to take ${i.name}.`,"error"),!1):t.time<i.time?(this.addLogMessage(`${this._getPlayerName(t)} needs ${i.time} hours to take ${i.name}.`,"error"),!1):(t.spendCash(i.cost),t.deductTime(i.time),t.advanceEducation(),this.addLogMessage(`${this._getPlayerName(t)} completed ${i.name}! Education level is now ${t.educationLevel}.`,"success"),this.checkWinCondition(t),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0):(this.addLogMessage("Course not found.","error"),!1)}buyItem(e){const t=this.getCurrentPlayer(),i=y.find(s=>s.name===e);return t.location!=="Shopping Mall"&&t.location!=="Fast Food"?(this.addLogMessage(`${this._getPlayerName(t)} must be at the Shopping Mall or Fast Food to shop.`,"error"),!1):i?t.cash<i.cost?(this.addLogMessage(`${this._getPlayerName(t)} needs ${this._formatMoney(i.cost)} to buy ${i.name}.`,"error"),!1):(t.spendCash(i.cost),t.updateHappiness(i.happinessBoost),i.hungerReduction?t.hunger=Math.max(0,t.hunger-i.hungerReduction):i.name==="Coffee"&&(t.hunger=Math.max(0,t.hunger-30)),(i.type==="asset"||i.name==="New Clothes")&&(t.inventory.some(s=>s.name===i.name)||t.inventory.push(i)),this.addLogMessage(`${this._getPlayerName(t)} bought ${i.name}! Happiness increased by ${i.happinessBoost}.`,"success"),this.checkWinCondition(t),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0):(this.addLogMessage("Item not found.","error"),!1)}deposit(e){const t=this.getCurrentPlayer();return t.location!=="Bank"?(this.addLogMessage(`${this._getPlayerName(t)} must be at the Bank to deposit cash.`,"error"),!1):e<=0?(this.addLogMessage("Deposit amount must be positive.","error"),!1):t.deposit(e)?(this.addLogMessage(`${this._getPlayerName(t)} deposited ${this._formatMoney(e)}.`,"success"),this.checkWinCondition(t),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0):(this.addLogMessage(`${this._getPlayerName(t)} doesn't have enough cash to deposit.`,"error"),!1)}withdraw(e){const t=this.getCurrentPlayer();return t.location!=="Bank"?(this.addLogMessage(`${this._getPlayerName(t)} must be at the Bank to withdraw cash.`,"error"),!1):e<=0?(this.addLogMessage("Withdrawal amount must be positive.","error"),!1):t.withdraw(e)?(this.addLogMessage(`${this._getPlayerName(t)} withdrew ${this._formatMoney(e)}.`,"success"),this.checkWinCondition(t),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0):(this.addLogMessage(`${this._getPlayerName(t)} doesn't have enough savings to withdraw.`,"error"),!1)}takeLoan(e){const t=this.getCurrentPlayer(),i=2500;return t.location!=="Bank"?(this.addLogMessage(`${this._getPlayerName(t)} must be at the Bank to take a loan.`,"error"),!1):e<=0?(this.addLogMessage("Loan amount must be positive.","error"),!1):t.loan+e>i?(this.addLogMessage(`Cannot exceed the ${this._formatMoney(i)} loan cap. Current loan: ${this._formatMoney(t.loan)}.`,"error"),!1):(t.takeLoan(e),t.addCash(e),this.addLogMessage(`${this._getPlayerName(t)} took a loan of ${this._formatMoney(e)}. Total loan: ${this._formatMoney(t.loan)}.`,"warning"),this.checkWinCondition(t),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0)}repayLoan(e){const t=this.getCurrentPlayer();return t.location!=="Bank"?(this.addLogMessage(`${this._getPlayerName(t)} must be at the Bank to repay a loan.`,"error"),!1):e<=0?(this.addLogMessage("Repayment amount must be positive.","error"),!1):t.cash<e?(this.addLogMessage(`${this._getPlayerName(t)} doesn't have enough cash to repay this amount.`,"error"),!1):e>t.loan?(this.addLogMessage(`Repayment amount (${this._formatMoney(e)}) cannot exceed outstanding loan (${this._formatMoney(t.loan)}).`,"error"),!1):(t.spendCash(e),t.repayLoan(e),this.addLogMessage(`${this._getPlayerName(t)} repaid ${this._formatMoney(e)}. Remaining loan: ${this._formatMoney(t.loan)}.`,"success"),this.checkWinCondition(t),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0)}buyCar(){const e=this.getCurrentPlayer(),t=3e3;return e.location!=="Used Car Lot"?(this.addLogMessage(`${this._getPlayerName(e)} must be at the Used Car Lot to buy a car.`,"error"),!1):e.hasCar?(this.addLogMessage(`${this._getPlayerName(e)} already owns a car.`,"warning"),!1):e.cash<t?(this.addLogMessage(`${this._getPlayerName(e)} needs ${this._formatMoney(t)} to buy a car.`,"error"),!1):(e.spendCash(t),e.giveCar(),this.addLogMessage(`${this._getPlayerName(e)} bought a car!`,"success"),this.checkWinCondition(e),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0)}travel(e){const t=this.getCurrentPlayer();if(t.location===e)return this.addLogMessage(`${this._getPlayerName(t)} is already at this location.`,"warning"),!1;const i=t.hasCar?1:2;if(t.time<i){if(e==="Home"){const s=i-t.time;return t.time=0,t.timeDeficit=s,t.setLocation(e),this.addLogMessage(`${this._getPlayerName(t)} traveled to ${e} despite being ${s} hour${s>1?"s":""} short. Starting next turn with ${s} hour${s>1?"s":""} less time.`,"warning"),this.checkWinCondition(t),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0}return this.addLogMessage(`${this._getPlayerName(t)} doesn't have enough time to travel.`,"error"),!1}return t.deductTime(i),t.setLocation(e),this.addLogMessage(`${this._getPlayerName(t)} traveled to ${e}.`,"info"),this.checkWinCondition(t),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0}applyForJob(e){const t=this.getCurrentPlayer(),i=f.find(s=>s.level===e);return i?t.careerLevel>=e?(this.addLogMessage(`${this._getPlayerName(t)} already has a job at this level or higher.`,"info"),!1):t.educationLevel<i.educationRequired?(this.addLogMessage(`Insufficient education for ${i.title}. Required: Level ${i.educationRequired}, Current: Level ${t.educationLevel}.`,"error"),r.publish("jobApplicationError",{player:t,job:i,reason:"Insufficient education"}),!1):(t.careerLevel=e,this.addLogMessage(`ðŸŽ‰ Congratulations! ${this._getPlayerName(t)} was hired as a ${i.title}!`,"success"),r.publish("jobApplicationSuccess",{player:t,job:i}),this.checkWinCondition(t),r.publish("stateChanged",this),this._checkAutoEndTurn(),!0):(this.addLogMessage(`Job level ${e} not found.`,"error"),r.publish("jobApplicationError",{player:t,reason:"Job not found"}),!1)}}const M=["Home","Employment Agency","Community College","Shopping Mall","Fast Food","Used Car Lot","Bank"];class S{gameState;uiManager;constructor(e,t){this.gameState=e,this.uiManager=t,this.initializeEventSubscriptions()}initializeEventSubscriptions(){r.subscribe(c.REST_END_TURN,()=>this.restEndTurn()),r.subscribe(c.ADVANCE_TURN,()=>this.advanceTurn()),r.subscribe(c.WORK_SHIFT,()=>this.workShift()),r.subscribe(c.BUY_CAR,()=>this.buyCar()),r.subscribe(c.TRAVEL,e=>this.travel(e)),r.subscribe(c.BANK_DEPOSIT,e=>this.gameState.deposit(e)),r.subscribe(c.BANK_WITHDRAW,e=>this.gameState.withdraw(e)),r.subscribe(c.BANK_LOAN,e=>this.gameState.takeLoan(e)),r.subscribe(c.BANK_REPAY,e=>this.gameState.repayLoan(e)),r.subscribe(c.APPLY_JOB,e=>this.gameState.applyForJob(e)),r.subscribe(c.TAKE_COURSE,e=>this.gameState.takeCourse(e)),r.subscribe(c.BUY_ITEM,e=>this.gameState.buyItem(e)),r.subscribe(c.REQUEST_STATE_REFRESH,()=>this.gameState.publishCurrentState())}restEndTurn(){this.gameState.endTurn()}advanceTurn(){this.gameState.advanceTurn()}workShift(){this.gameState.workShift()}buyCar(){this.uiManager.showChoiceModal({title:"Buy a Car?",choices:[{text:"Buy Hovercar ($3,000)",value:null,action:()=>this.gameState.buyCar()}]})}travel(e){if(e){this.gameState.travel(e);return}const t=this.gameState.getCurrentPlayer(),i=M.filter(s=>s!==t.location);this.uiManager.showChoiceModal({title:"Where to travel?",choices:i.map(s=>({text:s,value:s,action:n=>this.gameState.travel(n)}))})}deposit(){this.uiManager.showChoiceModal({title:"How much to deposit?",showInput:!0,choices:[{text:"Confirm Deposit",value:null,action:(e,t)=>{t&&t>0&&this.gameState.deposit(t)}}]})}withdraw(){this.uiManager.showChoiceModal({title:"How much to withdraw?",showInput:!0,choices:[{text:"Confirm Withdraw",value:null,action:(e,t)=>{t&&t>0&&this.gameState.withdraw(t)}}]})}takeLoan(){this.uiManager.showChoiceModal({title:"How much for loan?",showInput:!0,choices:[{text:"Confirm Loan",value:null,action:(e,t)=>{t&&t>0&&this.gameState.takeLoan(t)}}]})}repayLoan(){this.uiManager.showChoiceModal({title:"How much to repay?",showInput:!0,choices:[{text:"Confirm Repayment",value:null,action:(e,t)=>{t&&t>0&&this.gameState.repayLoan(t)}}]})}buyItem(){this.uiManager.showChoiceModal({title:"What to buy?",choices:y.map(e=>({text:`${e.name} ($${e.cost})`,value:e.name,action:t=>this.gameState.buyItem(t)}))})}takeCourse(){const e=this.gameState.getNextAvailableCourse();if(!e){this.gameState.addLogMessage("No more courses available.","warning");return}this.uiManager.showChoiceModal({title:"Take a Course?",choices:[{text:`${e.name} ($${e.cost})`,value:e.id,action:t=>this.gameState.takeCourse(parseInt(t,10))}]})}applyForJob(e){return e!==void 0?this.gameState.applyForJob(e):(this.uiManager.showJobApplicationModal(),!1)}}const E={"Employment Agency":{name:"Agent Smith",message:"Looking for a new start? I've got just the position for you.",icon:"clerk"},"Community College":{name:"Dean Wright",message:"Knowledge is the ultimate currency. Which course interests you?",icon:"clerk"},"Shopping Mall":{name:"Skylar",message:"Treat yourself! You've been working hard lately.",icon:"clerk"},"Fast Food":{name:"Chip",message:"Welcome to Monolith Burger! Big bites for big dreams. What can I get you?",icon:"clerk"},"Used Car Lot":{name:"Honest Hal",message:"I've got a deal that'll put you in the fast lane today!",icon:"clerk"},Bank:{name:"Teller 209",message:"Securing your future, one credit at a time. How can I assist?",icon:"clerk"}},u={chevronDown:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
    `,close:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
    `,standby:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path>
            <line x1="12" y1="2" x2="12" y2="12"></line>
        </svg>
    `,hoverCar:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.2-1.4.7L2 10s-1 1-1 2v3c0 .6.4 1 1 1h2"></path>
            <path d="M10 10l-2 4"></path>
            <path d="M14 10l2 4"></path>
            <rect x="4" y="17" width="4" height="2" rx="1"></rect>
            <rect x="16" y="17" width="4" height="2" rx="1"></rect>
        </svg>
    `,cyberChip:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect>
            <rect x="9" y="9" width="6" height="6"></rect>
            <line x1="9" y1="1" x2="9" y2="4"></line>
            <line x1="15" y1="1" x2="15" y2="4"></line>
            <line x1="9" y1="20" x2="9" y2="23"></line>
            <line x1="15" y1="20" x2="15" y2="23"></line>
            <line x1="20" y1="9" x2="23" y2="9"></line>
            <line x1="20" y1="15" x2="23" y2="15"></line>
            <line x1="1" y1="9" x2="4" y2="9"></line>
            <line x1="1" y1="15" x2="4" y2="15"></line>
        </svg>
    `,digitalContract:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
    `,neuralLink:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <circle cx="12" cy="12" r="4"></circle>
            <line x1="4.93" y1="4.93" x2="9.17" y2="9.17"></line>
            <line x1="14.83" y1="14.83" x2="19.07" y2="19.07"></line>
            <line x1="14.83" y1="9.17" x2="19.07" y2="4.93"></line>
            <line x1="4.93" y1="19.07" x2="9.17" y2="14.83"></line>
        </svg>
    `,smartBag:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <path d="M16 10a4 4 0 0 1-8 0"></path>
        </svg>
    `,cryptoVault:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2"></rect>
            <circle cx="12" cy="12" r="3"></circle>
            <line x1="12" y1="12" x2="15" y2="9"></line>
            <path d="M3 12h18"></path>
        </svg>
    `,currencyExchange:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 10h-4a2 2 0 0 1 0-4h4"></path>
            <path d="M7 14h4a2 2 0 0 0 0 4H7"></path>
            <path d="M12 4v16"></path>
            <path d="m17 14 4-4-4-4"></path>
            <path d="m7 10-4 4 4 4"></path>
        </svg>
    `,debtGraph:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
            <polyline points="17 6 23 6 23 12"></polyline>
        </svg>
    `,creditGraph:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
            <polyline points="17 18 23 18 23 12"></polyline>
        </svg>
    `,cityGrid:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
    `,bioMetrics:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 21a8 8 0 0 1 13.29-6"></path>
            <circle cx="10" cy="8" r="5"></circle>
            <path d="M19 16v6"></path>
            <path d="M22 19h-6"></path>
        </svg>
    `,cyberDeck:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m16 6 4 14H4L8 6Z"></path>
            <path d="M12 6V2"></path>
            <path d="M9 2h6"></path>
            <circle cx="12" cy="13" r="2"></circle>
        </svg>
    `,comms:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            <path d="M8 9h8"></path>
            <path d="M8 13h6"></path>
        </svg>
    `,system:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
    `,credits:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="5" width="20" height="14" rx="2"></rect>
            <line x1="2" y1="10" x2="22" y2="10"></line>
            <line x1="7" y1="15" x2="7.01" y2="15"></line>
            <line x1="11" y1="15" x2="11.01" y2="15"></line>
        </svg>
    `,smileChip:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
            <line x1="9" y1="9" x2="9.01" y2="9"></line>
            <line x1="15" y1="9" x2="15.01" y2="9"></line>
        </svg>
    `,careerLadder:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 3 5 21"></path>
            <path d="M19 11 5 11"></path>
            <path d="M19 16 5 16"></path>
            <path d="M19 6 5 6"></path>
        </svg>
    `,apartment:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 21h18"></path>
            <path d="M5 21V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16"></path>
            <path d="M9 9h6"></path>
            <path d="M9 13h6"></path>
            <path d="M9 17h6"></path>
        </svg>
    `,agency:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
    `,clerk:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
            <path d="M12 11l-2 5h4l-2 -5z" fill="${e}" fill-opacity="0.3"></path>
        </svg>
    `,fridge:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="5" y="2" width="14" height="20" rx="2"></rect>
            <line x1="5" y1="10" x2="19" y2="10"></line>
            <line x1="15" y1="5" x2="15" y2="7"></line>
            <line x1="15" y1="14" x2="15" y2="18"></line>
        </svg>
    `,computer:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
            <line x1="8" y1="21" x2="16" y2="21"></line>
            <line x1="12" y1="17" x2="12" y2="21"></line>
        </svg>
    `,television:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect>
            <polyline points="17 2 12 7 7 2"></polyline>
        </svg>
    `,clothes:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"></path>
        </svg>
    `,restaurant:(a=24,e="currentColor")=>`
        <svg width="${a}" height="${a}" viewBox="0 0 24 24" fill="none" stroke="${e}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 11h18a1 1 0 0 1 1 1v1a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1a1 1 0 0 1 1-1Z"></path>
            <path d="M3 18h18"></path>
            <path d="M4 11a8 8 0 0 1 16 0"></path>
        </svg>
    `};class w{overlay;titleElement;constructor(e,t){this.overlay=document.getElementById(e),this.titleElement=t?document.getElementById(t):null,this.overlay?.addEventListener("click",i=>{i.target===this.overlay&&this.hide()})}show(e={}){e.title&&this.titleElement&&(this.titleElement.textContent=e.title,this.titleElement.classList.remove("hidden")),this.overlay?.classList.remove("hidden"),document.body.style.overflow="hidden",r.publish("modalShown",{modalId:this.overlay?.id})}hide(){this.overlay?.classList.add("hidden"),document.body.style.overflow="",r.publish("modalHidden",{modalId:this.overlay?.id})}addSwipeToClose(e){let t=0,i=0,s=!1;const n=h=>{const d=h.touches[0],g=e.getBoundingClientRect();d.clientY-g.top<g.height*.25&&(t=d.clientY,s=!0,e.style.transition="none")},o=h=>{if(!s)return;i=h.touches[0].clientY;const d=i-t;if(d>0){e.style.transform=`translateY(${d}px)`;const g=Math.max(0,1-d/window.innerHeight);this.overlay&&(this.overlay.style.backgroundColor=`rgba(0, 0, 0, ${.8*g})`)}},l=()=>{if(!s)return;s=!1;const h=i-t,d=window.innerHeight*.3;e.style.transition="transform 0.3s ease, opacity 0.3s ease",h>d?(e.style.transform="translateY(100%)",e.style.opacity="0",setTimeout(()=>{this.hide(),e.style.transform="",e.style.opacity="",this.overlay&&(this.overlay.style.backgroundColor="")},300)):(e.style.transform="",this.overlay&&(this.overlay.style.backgroundColor=""))};e.addEventListener("touchstart",n,{passive:!0}),e.addEventListener("touchmove",o,{passive:!0}),e.addEventListener("touchend",l,{passive:!0})}}class I extends w{content;inputContainer;inputField;primaryButtons;secondaryActions;cancelButton;clerkContainer;clerkAvatar;clerkName;clerkMessage;constructor(){super("choice-modal-overlay","choice-modal-title"),this.content=document.getElementById("choice-modal-content"),this.inputContainer=document.getElementById("choice-modal-input"),this.inputField=document.getElementById("modal-input-amount"),this.primaryButtons=document.getElementById("choice-modal-buttons"),this.secondaryActions=document.getElementById("dashboard-secondary-actions"),this.cancelButton=document.getElementById("modal-cancel-button"),this.clerkContainer=document.getElementById("modal-clerk-container"),this.clerkAvatar=document.getElementById("modal-clerk-avatar"),this.clerkName=document.getElementById("modal-clerk-name"),this.clerkMessage=document.getElementById("modal-clerk-message"),this.cancelButton&&this.cancelButton.addEventListener("click",()=>this.hide())}setupClerk(e,t){e&&this.clerkContainer?(this.clerkContainer.classList.remove("hidden"),this.clerkAvatar&&(this.clerkAvatar.innerHTML=t[e.icon](40,"#00FFFF")),this.clerkName&&(this.clerkName.textContent=e.name),this.clerkMessage&&(this.clerkMessage.textContent=e.message),this.titleElement?.classList.add("hidden")):(this.clerkContainer?.classList.add("hidden"),this.titleElement?.classList.remove("hidden"))}clearContent(){this.content&&(this.content.innerHTML=""),this.primaryButtons&&(this.primaryButtons.innerHTML=""),this.secondaryActions&&(this.secondaryActions.innerHTML="")}showInput(e){e?(this.inputContainer?.classList.remove("hidden"),this.inputField&&(this.inputField.value="")):this.inputContainer?.classList.add("hidden")}getInputValue(){return this.inputField?parseInt(this.inputField.value,10):0}addPrimaryButton(e,t){const i=document.createElement("button");i.textContent=e,i.classList.add("btn","btn-primary"),i.onclick=()=>{const s=this.getInputValue();t(s)},this.primaryButtons?.appendChild(i)}addActionCard(e){this.content?.appendChild(e)}addSecondaryButton(e,t,i,s){const n=document.createElement("button");n.className=`btn ${i?"btn-primary":"btn-secondary"}`,n.innerHTML=`<i class="material-icons">${t}</i> <span>${e}</span>`,n.onclick=s,i?this.primaryButtons?.appendChild(n):this.secondaryActions?.appendChild(n)}setContent(e){this.content&&(this.content.innerHTML="",this.content.appendChild(e))}}class B extends w{cash;savings;loan;happiness;education;career;car;time;constructor(){super("player-stats-modal-overlay","player-stats-modal-title"),this.cash=document.getElementById("modal-cash"),this.savings=document.getElementById("modal-savings"),this.loan=document.getElementById("modal-loan"),this.happiness=document.getElementById("modal-happiness"),this.education=document.getElementById("modal-education"),this.career=document.getElementById("modal-career"),this.car=document.getElementById("modal-car"),this.time=document.getElementById("modal-time"),document.getElementById("player-stats-modal-close")?.addEventListener("click",()=>this.hide());const t=document.getElementById("player-stats-modal");t&&this.addSwipeToClose(t)}update(e,t,i,s){const n=document.getElementById("player-stats-modal");n&&(n.className=s===1?"player-1":"player-2"),this.cash&&(this.cash.textContent=`$${e.cash}`),this.savings&&(this.savings.textContent=`$${e.savings}`),this.loan&&(this.loan.textContent=`$${e.loan}`),this.happiness&&(this.happiness.textContent=e.happiness.toString());const o=t.find(h=>h.educationMilestone===e.educationLevel);this.education&&(this.education.textContent=o?o.name:"None");const l=i.find(h=>h.level===e.careerLevel);this.career&&(this.career.textContent=l?l.title:"Unemployed"),this.car&&(this.car.textContent=e.hasCar?"Yes":"No"),this.time&&(this.time.textContent=`${e.time} hours`)}}class P extends w{entries;constructor(){super("intel-terminal-overlay"),this.entries=document.getElementById("terminal-entries"),document.getElementById("intel-terminal-close")?.addEventListener("click",()=>this.hide())}updateEntries(e){if(this.entries){this.entries.innerHTML="",e.forEach(i=>{const s=document.createElement("p");typeof i=="string"?s.textContent=i:(s.textContent=i.text,s.className=`log-${i.category}`),this.entries?.appendChild(s)});const t=this.entries.parentElement;t&&setTimeout(()=>{t.scrollTop=t.scrollHeight},50)}}}class _ extends w{eventList;subtitle;cashTotal;happinessTotal;nextWeekBtn;constructor(){super("turn-summary-modal"),this.eventList=document.getElementById("event-list"),this.subtitle=document.getElementById("summary-subtitle"),this.cashTotal=document.getElementById("summary-cash-total"),this.happinessTotal=document.getElementById("summary-happiness-total"),this.nextWeekBtn=document.getElementById("btn-start-next-week")}update(e,t){this.subtitle&&(this.subtitle.textContent=`${e.playerName.toUpperCase()} - WEEK ${e.week} REPORT`),this.cashTotal&&(this.cashTotal.textContent=(e.totals.cashChange>=0?"+$":"-$")+Math.abs(e.totals.cashChange).toLocaleString(),this.cashTotal.className=`total-value ${e.totals.cashChange>=0?"log-success":"log-error"}`),this.happinessTotal&&(this.happinessTotal.textContent=(e.totals.happinessChange>=0?"+":"")+e.totals.happinessChange,this.happinessTotal.className=`total-value ${e.totals.happinessChange>=0?"log-success":"log-error"}`),this.eventList&&(this.eventList.innerHTML="",e.events.forEach((i,s)=>{const n=document.createElement("div");n.className=`event-card ${i.type}`;const o=(i.value>=0?"+":"-")+Math.abs(i.value).toLocaleString()+(i.unit==="$"?"$":" "+i.unit);n.innerHTML=`
            <div class="event-icon-circle">
              <i class="material-icons">${i.icon}</i>
            </div>
            <div class="event-info">
              <span class="event-name">${i.label}</span>
              <span class="event-amount">${o}</span>
            </div>
          `,this.eventList?.appendChild(n),setTimeout(()=>{n.classList.add("animate-in")},100*(s+1))})),this.nextWeekBtn&&(this.nextWeekBtn.onclick=t),setTimeout(()=>{this.cashTotal&&this.animateValue(this.cashTotal,0,e.totals.cashChange,1e3,"$"),this.happinessTotal&&this.animateValue(this.happinessTotal,0,e.totals.happinessChange,1e3)},500)}animateValue(e,t,i,s,n=""){if(!e)return;let o=null;const l=h=>{o||(o=h);const d=Math.min((h-o)/s,1),g=Math.floor(d*(i-t)+t),m=g>=0?"+":"-",k=Math.abs(g).toLocaleString();n==="$"?e.textContent=`${m}$${k}`:e.textContent=`${m}${k}`,d<1&&window.requestAnimationFrame(l)};window.requestAnimationFrame(l)}}class L{container;options;currentHours;svg;backgroundCircle;foregroundCircle;textElement;constructor(e,t={}){if(this.container=document.getElementById(e),!this.container)throw new Error(`Container with id "${e}" not found`);this.options={size:t.size||60,strokeWidth:t.strokeWidth||8,backgroundColor:t.backgroundColor||"rgba(0, 255, 255, 0.2)",foregroundColor:t.foregroundColor||"#00FFFF",textColor:t.textColor||"#FFFFFF",fontSize:t.fontSize||"14px",fontFamily:t.fontFamily||"VT323, monospace",showNumeric:t.showNumeric!==void 0?t.showNumeric:!0,animationDuration:t.animationDuration||500,...t},this.currentHours=24,this.init()}init(){this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this.options.size.toString()),this.svg.setAttribute("height",this.options.size.toString()),this.svg.setAttribute("viewBox",`0 0 ${this.options.size} ${this.options.size}`),this.svg.style.display="block",this.backgroundCircle=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.backgroundCircle.setAttribute("cx",(this.options.size/2).toString()),this.backgroundCircle.setAttribute("cy",(this.options.size/2).toString()),this.backgroundCircle.setAttribute("r",(this.options.size/2-this.options.strokeWidth/2).toString()),this.backgroundCircle.setAttribute("fill","none"),this.backgroundCircle.setAttribute("stroke",this.options.backgroundColor),this.backgroundCircle.setAttribute("stroke-width",this.options.strokeWidth.toString()),this.svg.appendChild(this.backgroundCircle),this.foregroundCircle=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.foregroundCircle.setAttribute("cx",(this.options.size/2).toString()),this.foregroundCircle.setAttribute("cy",(this.options.size/2).toString()),this.foregroundCircle.setAttribute("r",(this.options.size/2-this.options.strokeWidth/2).toString()),this.foregroundCircle.setAttribute("fill","none"),this.foregroundCircle.setAttribute("stroke",this.options.foregroundColor),this.foregroundCircle.setAttribute("stroke-width",this.options.strokeWidth.toString()),this.foregroundCircle.setAttribute("stroke-dasharray","0 1000"),this.foregroundCircle.setAttribute("transform",`rotate(-90 ${this.options.size/2} ${this.options.size/2})`),this.foregroundCircle.style.transition=`stroke-dasharray ${this.options.animationDuration}ms ease-in-out`,this.svg.appendChild(this.foregroundCircle),this.options.showNumeric&&(this.textElement=document.createElementNS("http://www.w3.org/2000/svg","text"),this.textElement.setAttribute("x",(this.options.size/2).toString()),this.textElement.setAttribute("y",(this.options.size/2).toString()),this.textElement.setAttribute("text-anchor","middle"),this.textElement.setAttribute("dominant-baseline","middle"),this.textElement.setAttribute("fill",this.options.textColor),this.textElement.setAttribute("font-size",this.options.fontSize),this.textElement.setAttribute("font-family",this.options.fontFamily),this.textElement.textContent="24h",this.svg.appendChild(this.textElement)),this.container&&(this.container.innerHTML="",this.container.appendChild(this.svg)),this.updateTime(24)}updateTime(e){e=Math.max(0,Math.min(24,e)),this.currentHours=e;const t=this.options.size/2-this.options.strokeWidth/2,i=2*Math.PI*t,s=(24-e)/24,n=i*s,o=i-n;this.foregroundCircle.setAttribute("stroke-dasharray",`${n} ${o}`),this.options.showNumeric&&this.textElement&&(this.textElement.textContent=`${e}h`);const l=1-e/24,h=this.getDarkerColor(this.options.foregroundColor,l);this.foregroundCircle.setAttribute("stroke",h),this.options.showNumeric&&this.textElement&&this.textElement.setAttribute("fill",h)}getDarkerColor(e,t){if(t===0)return e;let i,s,n;if(e.startsWith("#")){const l=e.substring(1);i=parseInt(l.substring(0,2),16),s=parseInt(l.substring(2,4),16),n=parseInt(l.substring(4,6),16)}else if(e.startsWith("rgb")){const l=e.match(/\d+/g);if(l)i=parseInt(l[0]),s=parseInt(l[1]),n=parseInt(l[2]);else return e}else return e;const o=1-t*.7;return i=Math.floor(i*o),s=Math.floor(s*o),n=Math.floor(n*o),`#${i.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}`}getCurrentHours(){return this.currentHours}destroy(){this.container&&this.svg&&this.container.removeChild(this.svg)}}class N{hudCash;hudWeek;hudLocation;orbP1;orbP2;terminalBadge;newsTickerContent;hudClockVisualizationP1=null;hudClockVisualizationP2=null;lastPlayerIndex=-1;unreadEvents=0;constructor(){this.hudCash=document.getElementById("hud-cash"),this.hudWeek=document.getElementById("hud-week"),this.hudLocation=document.getElementById("hud-location"),this.orbP1=document.getElementById("orb-p1"),this.orbP2=document.getElementById("orb-p2"),this.terminalBadge=document.getElementById("terminal-badge"),this.newsTickerContent=document.getElementById("news-ticker-content"),this.initializeClockVisualizations(),this.setupEventListeners()}initializeClockVisualizations(){document.getElementById("hud-time-ring-p1")&&(this.hudClockVisualizationP1=new L("hud-time-ring-p1",{size:52,strokeWidth:4,backgroundColor:"rgba(255, 0, 255, 0.1)",foregroundColor:"#FF00FF",textColor:"transparent",showNumeric:!1})),document.getElementById("hud-time-ring-p2")&&(this.hudClockVisualizationP2=new L("hud-time-ring-p2",{size:52,strokeWidth:4,backgroundColor:"rgba(0, 255, 255, 0.1)",foregroundColor:"#00FFFF",textColor:"transparent",showNumeric:!1}))}setupEventListeners(){r.subscribe("gameEvent",()=>{this.unreadEvents++,this.updateTerminalBadge()});const e=document.getElementById("orb-p1"),t=document.getElementById("orb-p2");e&&e.addEventListener("click",()=>r.publish("showPlayerStats",1)),t&&t.addEventListener("click",()=>r.publish("showPlayerStats",2));const i=document.getElementById("hud-terminal-trigger");i&&i.addEventListener("click",()=>{this.unreadEvents=0,this.updateTerminalBadge(),r.publish("showIntelTerminal")}),r.subscribe("logIconClicked",()=>{this.unreadEvents=0,this.updateTerminalBadge(),r.publish("showIntelTerminal")})}update(e){const t=e.players[0],i=e.players.length>1?e.players[1]:null,s=e.getCurrentPlayer(),n=e.currentPlayerIndex;if(this.orbP1&&(this.orbP1.classList.toggle("active",n===0),this.orbP1.classList.toggle("inactive",n!==0),this.lastPlayerIndex!==n&&n===0&&(this.orbP1.classList.add("pulse"),setTimeout(()=>this.orbP1?.classList.remove("pulse"),600))),this.orbP2&&(this.orbP2.classList.toggle("active",n===1),this.orbP2.classList.toggle("inactive",n!==1),this.lastPlayerIndex!==n&&n===1&&(this.orbP2.classList.add("pulse"),setTimeout(()=>this.orbP2?.classList.remove("pulse"),600))),this.lastPlayerIndex=n,this.hudClockVisualizationP1&&this.hudClockVisualizationP1.updateTime(t.time),this.hudClockVisualizationP2&&i&&this.hudClockVisualizationP2.updateTime(i.time),this.hudCash&&(this.hudCash.textContent=`$${s.cash}`),this.hudWeek&&(this.hudWeek.textContent=e.turn.toString()),this.hudLocation&&(this.hudLocation.textContent=s.location),this.newsTickerContent&&e.log.length>0){const o=e.log.slice(-5).map(l=>typeof l=="string"?l:l.text).join("  â€¢  ");this.newsTickerContent.textContent=o}}updateTerminalBadge(){this.terminalBadge&&(this.unreadEvents>0?(this.terminalBadge.textContent=this.unreadEvents>99?"99+":this.unreadEvents.toString(),this.terminalBadge.classList.remove("hidden")):this.terminalBadge.classList.add("hidden"))}}class A{screens;tabItems;currentScreenId;cityBentoGrid;fabNextWeek;choiceModal;playerStatsModal;intelTerminalModal;turnSummaryModal;hud;gameState=null;lastLocation=null;lastPlayerId=null;lifeAvatar;statusChips;essentialsGrid;assetsGrid;loadingOverlay;locationHint;constructor(){this.screens=document.querySelectorAll(".screen"),this.tabItems=document.querySelectorAll(".tab-item"),this.currentScreenId="city",this.cityBentoGrid=document.getElementById("city-bento-grid"),this.fabNextWeek=document.getElementById("fab-next-week"),this.locationHint=document.getElementById("location-hint"),this.hud=new N,this.choiceModal=new I,this.playerStatsModal=new B,this.intelTerminalModal=new P,this.turnSummaryModal=new _,this.lastLocation=null,this.lastPlayerId=null,this.lifeAvatar=document.getElementById("life-avatar"),this.statusChips=document.getElementById("status-chips"),this.essentialsGrid=document.getElementById("essentials-grid"),this.assetsGrid=document.getElementById("assets-grid"),this.loadingOverlay=document.getElementById("loading-overlay"),r.subscribe("aiThinkingStart",()=>this.showLoading()),r.subscribe("aiThinkingEnd",()=>this.hideLoading()),r.subscribe("stateChanged",e=>{this.gameState=e,this.render(e)}),r.subscribe("turnEnded",e=>{this.showTurnSummary(e)}),r.subscribe("showPlayerStats",e=>this.showPlayerStatsModal(e)),r.subscribe("showIntelTerminal",()=>this.showIntelTerminal()),r.subscribe("addToLog",()=>{r.publish(c.REQUEST_STATE_REFRESH)}),this.fabNextWeek&&this.fabNextWeek.addEventListener("click",()=>{r.publish(c.REST_END_TURN)}),this.initializeScreenSwitching()}showIntelTerminal(){this.gameState&&(this.intelTerminalModal.updateEntries(this.gameState.log),this.intelTerminalModal.show())}hideIntelTerminal(){this.intelTerminalModal.hide()}initializeScreenSwitching(){const e=document.getElementById("icon-city"),t=document.getElementById("icon-life"),i=document.getElementById("icon-inventory"),s=document.getElementById("icon-social"),n=document.getElementById("icon-menu");e&&(e.innerHTML=u.cityGrid(20,"rgba(255, 255, 255, 0.5)")),t&&(t.innerHTML=u.bioMetrics(20,"rgba(255, 255, 255, 0.5)")),i&&(i.innerHTML=u.cyberDeck(20,"rgba(255, 255, 255, 0.5)")),s&&(s.innerHTML=u.comms(20,"rgba(255, 255, 255, 0.5)")),n&&(n.innerHTML=u.system(20,"rgba(255, 255, 255, 0.5)")),this.tabItems.forEach(o=>{o.addEventListener("click",()=>{const l=o.dataset.screen;l&&this.switchScreen(l)})})}switchScreen(e){this.currentScreenId!==e&&(this.currentScreenId=e,this.screens.forEach(t=>{t.id===`screen-${e}`?t.classList.remove("hidden"):t.classList.add("hidden")}),this.tabItems.forEach(t=>{const i=t.querySelector(".tab-icon"),s=i?i.querySelector("svg"):null;t.dataset.screen===e?(t.classList.add("active"),s&&s.setAttribute("stroke","#00FFFF")):(t.classList.remove("active"),s&&s.setAttribute("stroke","rgba(255, 255, 255, 0.5)"))}),this.gameState&&this.render(this.gameState),r.publish("screenSwitched",e))}showChoiceModal({title:e,choices:t,showInput:i=!1}){const s=this.gameState?this.gameState.getCurrentPlayer().location:null,n=s?E[s]:null;if(this.choiceModal.setupClerk(n,u),this.choiceModal.clearContent(),this.choiceModal.showInput(i),s==="Shopping Mall"||s==="Fast Food"){const o=y.filter(l=>l.location===s);this.renderActionCards("shopping",o)}else s==="Community College"?this.renderActionCards("college",v):t.forEach(o=>{this.choiceModal.addPrimaryButton(o.text,l=>{this.choiceModal.hide(),o.action(o.value,l)})});this.choiceModal.show({title:e})}showLocationDashboard(e){if(!this.gameState)return;const t=this.gameState.getCurrentPlayer(),i=E[e];if(this.choiceModal.setupClerk(i,u),this.choiceModal.clearContent(),this.choiceModal.showInput(!1),e==="Employment Agency")this.renderActionCards("jobs",f);else if(e==="Community College")this.renderActionCards("college",v);else if(e==="Shopping Mall"||e==="Fast Food"){const n=y.filter(o=>o.location===e);this.renderActionCards("shopping",n)}this.getLocationActions(e).forEach(n=>{this.choiceModal.addSecondaryButton(n.label,n.icon,n.primary,o=>{if(n.label==="Work Shift"){const l=f.find(h=>h.level===t.careerLevel);l&&this.spawnFeedback(o.currentTarget,`+$${l.wage*8}`,"success")}n.label!=="Work Shift"&&this.choiceModal.hide(),n.onClick(),n.label==="Work Shift"&&setTimeout(()=>{this.showLocationDashboard(e)},100)})}),e==="Bank"&&(this.choiceModal.showInput(!0),[{text:"Deposit",value:"deposit",action:o=>r.publish(c.BANK_DEPOSIT,o)},{text:"Withdraw",value:"withdraw",action:o=>r.publish(c.BANK_WITHDRAW,o)},{text:"Take Loan",value:"loan",action:o=>r.publish(c.BANK_LOAN,o)},{text:"Repay Loan",value:"repay",action:o=>r.publish(c.BANK_REPAY,o)}].forEach(o=>{this.choiceModal.addSecondaryButton(o.text,"payments",!1,l=>{const h=this.choiceModal.getInputValue();o.value==="deposit"||o.value==="repay"?this.spawnFeedback(l.currentTarget,`-$${h}`,"error"):this.spawnFeedback(l.currentTarget,`+$${h}`,"success"),o.action(h),setTimeout(()=>{this.showLocationDashboard("Bank")},100)})})),this.choiceModal.show({title:e})}spawnFeedback(e,t,i){const s=e.getBoundingClientRect(),n=document.createElement("div");n.className=`feedback-particle log-${i}`,n.textContent=t,n.style.left=`${s.left+s.width/2}px`,n.style.top=`${s.top}px`,document.body.appendChild(n),setTimeout(()=>{n.remove()},800)}hideModal(){this.choiceModal.hide()}showJobApplicationModal(){this.showLocationDashboard("Employment Agency")}renderActionCards(e,t){const i=this.gameState?this.gameState.getCurrentPlayer():null,s=document.createElement("div");s.className="action-card-list",t.forEach(n=>{const o=document.createElement("div");o.className="action-card";let l="",h="",d=!1,g=!1,C=()=>{},m="",k="success",b="";if(e==="jobs"){l=n.title,d=!!(i&&i.educationLevel<n.educationRequired),g=!!(i&&i.careerLevel===n.level);const p=!!(i&&i.careerLevel>n.level);m=g?"Hired":p?"Lower Level":"Apply",p&&(d=!0),h=`
          <span class="action-card-tag price"><i class="material-icons">payments</i>$${n.wage}/hr</span>
          <span class="action-card-tag"><i class="material-icons">schedule</i>${n.shiftHours}h</span>
          <span class="action-card-tag requirement ${d?"locked":""}">
            <i class="material-icons">${d?"lock":"school"}</i>Edu Lvl ${n.educationRequired}
          </span>
        `,C=()=>r.publish(c.APPLY_JOB,n.level),b="HIRED!"}else if(e==="college"){l=n.name,d=!!(i&&i.educationLevel<n.educationMilestone-1);const p=!!(i&&i.educationLevel>=n.educationMilestone);m=p?"Completed":"Study",p&&(d=!0),h=`
          <span class="action-card-tag price ${d&&!p?"locked":""}"><i class="material-icons">payments</i>$${n.cost}</span>
          <span class="action-card-tag"><i class="material-icons">history</i>${n.time}h total</span>
        `,C=()=>r.publish(c.TAKE_COURSE,n.id),b=`-$${n.cost}`,k="error"}else if(e==="shopping"){l=n.name,d=!!(i&&i.cash<n.cost),m="Buy";let p=`<span class="action-card-tag"><i class="material-icons">sentiment_very_satisfied</i>+${n.happinessBoost} Happy</span>`;n.hungerReduction&&(p+=`<span class="action-card-tag"><i class="material-icons">restaurant</i>-${n.hungerReduction} Hunger</span>`),h=`
          <span class="action-card-tag price ${d?"locked":""}"><i class="material-icons">payments</i>$${n.cost}</span>
          ${p}
        `,C=()=>r.publish(c.BUY_ITEM,n.name),b=`-$${n.cost}`,k="error"}(d||g)&&o.classList.add("locked"),g&&o.classList.add("hired"),o.innerHTML=`
        <div class="action-card-content">
          <div class="action-card-title">${l}</div>
          <div class="action-card-meta">${h}</div>
        </div>
        <div class="action-card-action">
          <button class="btn btn-primary action-card-btn" ${d||g?"disabled":""}>
            ${m}
          </button>
        </div>
      `,!d&&!g&&(o.onclick=p=>{this.spawnFeedback(p.currentTarget,b,k),e!=="jobs"&&this.choiceModal.hide(),C(),e==="jobs"&&setTimeout(()=>{this.showLocationDashboard("Employment Agency")},100)}),s.appendChild(o)}),this.choiceModal.setContent(s)}showPlayerStatsModal(e){if(!this.gameState||!this.gameState.players[e-1])return;const t=this.gameState.players[e-1];this.playerStatsModal.update(t,v,f,e),this.playerStatsModal.show()}hidePlayerStatsModal(){this.playerStatsModal.hide()}showLoading(){this.loadingOverlay?.classList.remove("hidden"),document.body.classList.add("loading-active")}hideLoading(){this.loadingOverlay?.classList.add("hidden"),document.body.classList.remove("loading-active")}showTurnSummary(e){this.turnSummaryModal.update(e,()=>{window.navigator&&window.navigator.vibrate&&window.navigator.vibrate(10),this.turnSummaryModal.hide(),r.publish(c.ADVANCE_TURN)}),this.turnSummaryModal.show()}hideTurnSummary(){this.turnSummaryModal.hide()}render(e){this.hud.update(e);const t=e.getCurrentPlayer();this.updateLocationHint(t.location);const i=this.lastPlayerId!==null&&this.lastPlayerId!==t.id;this.lastLocation!==null&&this.lastLocation!==t.location&&t.location!=="Home"&&!i&&!t.isAI&&setTimeout(()=>{this.showLocationDashboard(t.location)},300),this.lastLocation=t.location,this.lastPlayerId=t.id,this.currentScreenId==="city"?this.renderCityGrid(e):this.currentScreenId==="life"?this.renderLifeScreen(e):this.currentScreenId==="inventory"&&this.renderInventoryScreen(e)}getLocationActions(e){const t=[];switch(e){case"Home":t.push({label:"Rest / End Turn",icon:"bedtime",primary:!0,onClick:()=>r.publish(c.REST_END_TURN)});break;case"Employment Agency":t.push({label:"Work Shift",icon:"work",primary:!0,onClick:()=>r.publish(c.WORK_SHIFT)});break;case"Community College":t.push({label:"Browse Courses",icon:"school",primary:!0,onClick:()=>this.showLocationDashboard("Community College")});break;case"Shopping Mall":t.push({label:"Browse Items",icon:"shopping_bag",primary:!0,onClick:()=>this.showLocationDashboard("Shopping Mall")});break;case"Fast Food":t.push({label:"Browse Menu",icon:"lunch_dining",primary:!0,onClick:()=>this.showLocationDashboard("Fast Food")});break;case"Used Car Lot":t.push({label:"View Inventory",icon:"directions_car",primary:!0,onClick:()=>r.publish(c.BUY_CAR)});break;case"Bank":t.push({label:"Financial Services",icon:"account_balance",primary:!0,onClick:()=>this.showLocationDashboard("Bank")});break}return t}showBankModal(){this.showLocationDashboard("Bank")}updateLocationHint(e){let t="";switch(e){case"Home":t="Rest and end your turn here";break;case"Employment Agency":t="Find work and earn money";break;case"Community College":t="Improve your education for better jobs";break;case"Shopping Mall":t="Buy items to boost your happiness";break;case"Fast Food":t="Grab a quick bite to eat";break;case"Used Car Lot":t="Purchase a car for faster travel";break;case"Bank":t="Manage your finances: deposit, withdraw, or take a loan";break;default:t="Travel to other locations"}this.locationHint&&(this.locationHint.textContent=t)}renderCityGrid(e){if(!this.cityBentoGrid)return;const t=e.getCurrentPlayer();this.cityBentoGrid.innerHTML="",M.forEach(i=>{const s=document.createElement("div");s.className=`bento-card ${t.location===i?"active":""}`;let n="";switch(i){case"Home":n=u.apartment(32,"#FF00FF");break;case"Employment Agency":n=u.agency(32,"#00FFFF");break;case"Community College":n=u.cyberChip(32,"#2979FF");break;case"Shopping Mall":n=u.smartBag(32,"#FFD600");break;case"Fast Food":n=u.restaurant(32,"#FF9100");break;case"Used Car Lot":n=u.hoverCar(32,"#00E676");break;case"Bank":n=u.cryptoVault(32,"#FF5252");break}s.innerHTML=`
        <div class="bento-card-icon">${n}</div>
        <div class="bento-card-title">${i}</div>
        <div class="bento-card-info">${this.getLocationSummary(i)}</div>
      `,s.onclick=()=>{t.location!==i?r.publish(c.TRAVEL,i):this.showLocationDashboard(i)},this.cityBentoGrid?.appendChild(s)}),this.fabNextWeek&&(t.location==="Home"?this.fabNextWeek.classList.remove("hidden"):this.fabNextWeek.classList.add("hidden"))}getLocationSummary(e){switch(e){case"Home":return"Rest and end turn";case"Employment Agency":return"Find work";case"Community College":return"Study courses";case"Shopping Mall":return"Buy items";case"Fast Food":return"Eat food";case"Used Car Lot":return"Buy a car";case"Bank":return"Savings & Loans";default:return""}}renderLifeScreen(e){const t=e.getCurrentPlayer(),i=e.currentPlayerIndex;if(this.lifeAvatar&&(this.lifeAvatar.textContent=i===0?"P1":"AI",this.lifeAvatar.style.background=i===0?"linear-gradient(135deg, var(--neon-pink), #D500F9)":"linear-gradient(135deg, var(--neon-cyan), var(--neon-blue))"),this.statusChips){if(this.statusChips.innerHTML="",t.time>12){const h=document.createElement("span");h.className="status-chip chip-success",h.textContent="Well-Rested",this.statusChips.appendChild(h)}if(t.hunger>50){const h=document.createElement("span");h.className=`status-chip ${t.hunger>80?"chip-danger":"chip-warning"}`,h.textContent=t.hunger>80?"Starving":"Hungry",this.statusChips.appendChild(h)}else{const h=document.createElement("span");h.className="status-chip chip-success",h.textContent="Satiated",this.statusChips.appendChild(h)}if(t.loan>0){const h=document.createElement("span");h.className="status-chip chip-danger",h.textContent="In Debt",this.statusChips.appendChild(h)}}const s=Math.min(100,Math.round((t.cash+t.savings)/1e4*100)),n=t.happiness,o=Math.min(100,Math.round(t.educationLevel/5*100)),l=Math.min(100,Math.round(t.careerLevel/5*100));this.updateGauge("wealth",s,"#00E676"),this.updateGauge("happiness",n,"#FFD600"),this.updateGauge("education",o,"#2979FF"),this.updateGauge("career",l,"#FF00FF")}updateGauge(e,t,i){const s=document.getElementById(`gauge-${e}`);if(!s)return;const n=45,o=2*Math.PI*n,l=o-t/100*o;s.innerHTML=`
      <svg viewBox="0 0 100 100" class="gauge-svg">
        <circle class="gauge-ring-background" cx="50" cy="50" r="${n}"></circle>
        <circle class="gauge-ring-fill" cx="50" cy="50" r="${n}" 
                style="stroke-dasharray: ${o}; stroke-dashoffset: ${l}; stroke: ${i};">
        </circle>
      </svg>
      <div class="gauge-percentage">${t}%</div>
    `}renderInventoryScreen(e){const t=e.getCurrentPlayer();this.essentialsGrid&&(this.essentialsGrid.innerHTML="",y.filter(s=>s.type==="essential"&&s.icon).forEach(s=>{const n=t.inventory.some(l=>l.name===s.name),o=document.createElement("div");o.className=`essential-item ${n?"owned":""}`,s.icon&&(o.innerHTML=u[s.icon](32,n?"#00FFFF":"rgba(255,255,255,0.2)")),o.title=s.name,this.essentialsGrid?.appendChild(o)})),this.assetsGrid&&(this.assetsGrid.innerHTML="",y.filter(s=>s.type==="asset").forEach(s=>{const n=t.inventory.some(l=>l.name===s.name),o=document.createElement("div");o.className=`inventory-card glass ${n?"owned":""}`,o.innerHTML=`
          <div class="inventory-card-icon">
            ${s.icon?u[s.icon](40,n?"#00FFFF":"rgba(255,255,255,0.2)"):""}
          </div>
          <div class="inventory-card-content">
            <div class="inventory-card-name">${s.name}</div>
            <div class="inventory-card-benefit">${s.benefit}</div>
          </div>
        `,this.assetsGrid?.appendChild(o)}))}}class F{gameController;constructor(e){this.gameController=e}initialize(){const e=document.querySelector(".app-shell");if(!e)return;const t="ontouchstart"in window?"touchstart":"click";e.addEventListener(t,i=>{const s=i.target.closest("[data-action]");if(!s)return;const n=s.dataset.action;n&&(typeof this.gameController[n]=="function"?this.gameController[n]():console.warn(`Action "${n}" is not defined on GameController.`))})}}class H{displayTimeout;displayDuration;eventStrip;eventText;constructor(){this.displayTimeout=null,this.displayDuration=3500,this.init()}init(){this.createEventStrip(),r.subscribe("gameEvent",e=>{this.addEvent(e)})}createEventStrip(){this.eventStrip=document.createElement("div"),this.eventStrip.id="event-notification-strip",this.eventStrip.className="event-notification-strip hidden",this.eventText=document.createElement("div"),this.eventText.className="event-notification-text",this.eventStrip.appendChild(this.eventText),this.eventStrip.addEventListener("click",()=>{r.publish("logIconClicked"),this.hideEvent()});let e=0;this.eventStrip.addEventListener("touchstart",i=>{e=i.touches[0].clientX},{passive:!0}),this.eventStrip.addEventListener("touchend",i=>{const s=i.changedTouches[0].clientX;Math.abs(s-e)>50&&this.hideEvent()},{passive:!0});const t=document.getElementById("game-controls");if(t&&t.parentNode)t.parentNode.insertBefore(this.eventStrip,t);else{const i=document.querySelector(".app-shell");i&&i.appendChild(this.eventStrip)}}addEvent(e){this.displayTimeout&&(clearTimeout(this.displayTimeout),this.displayTimeout=null),this.displayEvent(e),this.displayTimeout=setTimeout(()=>{this.hideEvent()},this.displayDuration)}displayEvent(e){this.eventText.textContent=typeof e=="string"?e:e.text,e&&e.category?this.eventText.className=`event-notification-text log-${e.category}`:this.eventText.className="event-notification-text",this.eventStrip.classList.remove("hidden"),this.eventStrip.classList.add("show"),this.eventStrip.classList.remove("shrinking")}hideEvent(){this.eventStrip.classList.add("shrinking"),setTimeout(()=>{this.eventStrip.classList.remove("show","shrinking"),this.eventStrip.classList.add("hidden"),this.displayTimeout=null},500)}}function R(){const a=new T(2,!0),e=new A,t=new S(a,e);new H,new F(t).initialize(),a.publishCurrentState()}document.addEventListener("DOMContentLoaded",R);
